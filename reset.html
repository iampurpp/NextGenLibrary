<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Password Reset | NextGen Library Hub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="css/stylez.css" />
  </head>
  <body>
    <div class="auth-background">
      <div class="shape"></div>
      <div class="shape"></div>
    </div>

    <div class="auth-container">
      <div class="auth-card">
        <div class="logo">
          <i class="fas fa-book-open"></i>
          <h2>NextGen Library Hub</h2>
        </div>

        <h3>Password Reset</h3>

        <div class="form-group">
          <label for="email"><i class="fas fa-envelope"></i> Email Address</label>
          <input type="email" id="email" placeholder="student@school.edu.zw" />
        </div>

        <div id="error-message" class="error-message"></div>
        <div id="success-message" class="success-message"></div>

        <button id="reset-btn" class="auth-btn">
          <i class="fas fa-paper-plane"></i> Send Reset Link
        </button>

        <div class="auth-footer">
          Remembered your password? <a href="login.html">Back to login</a>
        </div>
      </div>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
      import { getAuth, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDNKHjmGKMTJhTGWqI-i8VzaqwVxvnb7tw",
        authDomain: "nextgenlibraryhub.firebaseapp.com",
        projectId: "nextgenlibraryhub",
        storageBucket: "nextgenlibraryhub.appspot.com",
        messagingSenderId: "18107313735",
        appId: "1:18107313735:web:54edbb5aca14ca66670b62",
        measurementId: "G-VHRJSKY7W5",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      const resetBtn = document.getElementById("reset-btn");
      const emailInput = document.getElementById("email");
      const errorMessage = document.getElementById("error-message");
      const successMessage = document.getElementById("success-message");

      resetBtn.addEventListener("click", async () => {
        errorMessage.textContent = "";
        successMessage.textContent = "";

        const email = emailInput.value.trim();
        if (!email) {
          errorMessage.textContent = "Please enter your email address";
          return;
        }

        try {
          await sendPasswordResetEmail(auth, email);
          successMessage.textContent = `Password reset email sent to ${email}`;
        } catch (error) {
          console.error("Reset error:", error);
          errorMessage.textContent = getErrorMessage(error.code);
        }
      });

      function getErrorMessage(code) {
        switch (code) {
          case "auth/invalid-email":
            return "Invalid email address";
          case "auth/user-not-found":
            return "No account found with this email";
          case "auth/too-many-requests":
            return "Too many attempts. Try again later";
          default:
            return "Failed to send reset email. Please try again";
        }
      }
    </script>
  </body>
</html>